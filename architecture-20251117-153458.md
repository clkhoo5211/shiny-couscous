# ğŸ—ï¸ Labuan FSA E-Submission System - Technical Architecture

**Project**: Labuan FSA E-Online Submission System  
**Created**: 2025-11-17 15:34:58  
**Status**: Design Phase  
**Version**: 1.0.0

---

## ğŸ¯ ARCHITECTURE OVERVIEW

**Architecture Pattern**: 3-Tier Architecture (Presentation, Application, Data)  
**Design Principles**: API-Driven, Modular, Scalable, Secure  
**Deployment Strategy**: Containerized, Cloud-Native

---

## ğŸ“Š SYSTEM ARCHITECTURE DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Web Browser    â”‚  â”‚   Mobile Browser â”‚  â”‚   Admin Panel    â”‚  â”‚
â”‚  â”‚   (React SPA)    â”‚  â”‚   (Responsive)   â”‚  â”‚   (React Admin)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS
                              â”‚ REST API
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY / LOAD BALANCER                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Rate Limiting  â”‚  â”‚   CORS Handler   â”‚  â”‚   Auth Middlewareâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APPLICATION LAYER (FastAPI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    API ROUTERS                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚  Forms   â”‚  â”‚Submissionsâ”‚  â”‚   Admin  â”‚  â”‚   Auth   â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  Routes  â”‚  â”‚  Routes   â”‚  â”‚  Routes  â”‚  â”‚  Routes  â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    SERVICE LAYER                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚   Form   â”‚  â”‚Submissionâ”‚  â”‚Validationâ”‚  â”‚   File   â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  Service â”‚  â”‚  Service â”‚  â”‚  Service â”‚  â”‚  Service â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    CONFIGURATION                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚   TOML   â”‚  â”‚  Secrets â”‚  â”‚  Settingsâ”‚                     â”‚ â”‚
â”‚  â”‚  â”‚  Config  â”‚  â”‚ Manager  â”‚  â”‚  Loader  â”‚                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA LAYER (PostgreSQL)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  Forms   â”‚  â”‚Submissionsâ”‚  â”‚   Files  â”‚  â”‚  Fields  â”‚          â”‚ â”‚
â”‚  â”‚  Table   â”‚  â”‚   Table   â”‚  â”‚   Table  â”‚  â”‚  Table   â”‚          â”‚ â”‚
â”‚  â”‚ (JSONB)  â”‚  â”‚  (JSONB)  â”‚  â”‚          â”‚  â”‚  (JSONB) â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚   File   â”‚  â”‚  Cloud   â”‚  â”‚  Payment â”‚  â”‚  Email   â”‚          â”‚ â”‚
â”‚  â”‚  Storage â”‚  â”‚ Secrets  â”‚  â”‚  Gateway â”‚  â”‚ Service  â”‚          â”‚ â”‚
â”‚  â”‚  (S3)    â”‚  â”‚ Manager  â”‚  â”‚(Stripe)  â”‚  â”‚          â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ ARCHITECTURE LAYERS

### Layer 1: Presentation Layer (Frontend)

**Technology**: React 18+ (TypeScript), Tailwind CSS  
**Architecture Pattern**: Component-Based, API-Driven Dynamic Rendering

**Key Components**:
- **DynamicForm**: Main form component that fetches and renders forms from API
- **FormRenderer**: Recursive renderer that interprets API schema
- **Field Components**: 85+ modular field components (InputField, SelectField, etc.)
- **Layout Components**: FormContainer, FormSection, FormStep
- **Admin Dashboard**: React Admin or custom dashboard

**Responsibilities**:
- Render all DOM elements dynamically from API responses
- Client-side validation
- Form state management (React Hook Form/Formik)
- File upload UI with progress tracking
- Responsive design (mobile, tablet, desktop)
- Accessibility compliance (WCAG 2.1 AA)

---

### Layer 2: Application Layer (Backend)

**Technology**: Python 3.11+, FastAPI, SQLAlchemy 2.0+  
**Architecture Pattern**: Service-Oriented, RESTful API

**Key Components**:

#### 2.1 API Routes (`src/labuan_fsa/api/routes/`)
- **forms.py**: Form schema endpoints (GET /api/forms, GET /api/forms/{formId}/schema)
- **submissions.py**: Submission endpoints (POST /api/forms/{formId}/submit, POST /api/forms/{formId}/validate)
- **admin.py**: Admin dashboard endpoints (GET /api/admin/submissions, PUT /api/admin/submissions/{id})
- **auth.py**: Authentication endpoints (POST /api/auth/login, POST /api/auth/register)
- **files.py**: File upload endpoints (POST /api/files/upload)

#### 2.2 Service Layer (`src/labuan_fsa/services/`)
- **form_service.py**: Form schema generation and management
- **submission_service.py**: Form submission processing
- **validation_service.py**: Server-side validation logic
- **file_service.py**: File upload and storage management
- **admin_service.py**: Admin operations (review, approve, reject)

#### 2.3 Configuration (`src/labuan_fsa/config.py`)
- **TOML Configuration**: Loads from config.toml (version-controlled)
- **Secrets Management**: Cloud secrets manager integration (AWS, Azure, GCP)
- **Environment Settings**: Environment-specific configuration (dev, staging, prod)

**Responsibilities**:
- Generate form schemas from database (JSONB)
- Process form submissions with validation
- Manage file uploads and storage
- Admin dashboard backend operations
- Authentication and authorization (JWT)
- API documentation (OpenAPI/Swagger)

---

### Layer 3: Data Layer (Database)

**Technology**: PostgreSQL 14+  
**Storage Strategy**: JSONB for flexible form schema and submission data

**Key Tables**:
- **forms**: Form definitions with JSONB schema data
- **form_submissions**: Form submissions with JSONB submitted data
- **file_uploads**: File upload metadata
- **form_fields**: Field definitions for admin management
- **users**: User accounts (optional, if authentication required)
- **audit_logs**: System audit trail

**Responsibilities**:
- Store form schemas as JSONB (flexible structure)
- Store submission data as JSONB (dynamic fields)
- Maintain referential integrity
- Provide efficient querying with indexes
- Support full-text search on JSONB fields

---

## ğŸ”— COMPONENT INTERACTIONS

### Form Rendering Flow

```
1. Frontend: User selects form
   â†“
2. Frontend: GET /api/forms/{formId}/schema
   â†“
3. Backend: Query form from database (JSONB schema)
   â†“
4. Backend: Return complete form schema JSON
   â†“
5. Frontend: DynamicForm receives schema
   â†“
6. Frontend: FormRenderer recursively renders fields
   â†“
7. Frontend: Field components render based on schema
```

### Form Submission Flow

```
1. Frontend: User fills form and clicks submit
   â†“
2. Frontend: Client-side validation
   â†“
3. Frontend: POST /api/forms/{formId}/validate (optional)
   â†“
4. Backend: Server-side validation
   â†“
5. Frontend: POST /api/forms/{formId}/submit
   â†“
6. Backend: Process submission, save to database (JSONB)
   â†“
7. Backend: Upload files (if any) to storage
   â†“
8. Backend: Return submission ID and confirmation
   â†“
9. Frontend: Display success message with submission ID
```

---

## ğŸ—„ï¸ DATABASE ARCHITECTURE

### Core Tables

#### 1. `forms` Table
**Purpose**: Store form definitions with complete schema

**Schema**:
```sql
CREATE TABLE forms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    form_id VARCHAR(100) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    version VARCHAR(50) NOT NULL,
    schema_data JSONB NOT NULL,  -- Complete form schema
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**JSONB Structure** (`schema_data`):
```json
{
  "formId": "form-a",
  "formName": "Form A: License Application",
  "version": "1.0.0",
  "steps": [
    {
      "stepId": "step-1",
      "stepName": "Business Information",
      "stepOrder": 1,
      "fields": [
        {
          "fieldId": "company-name",
          "fieldType": "input-text",
          "fieldName": "companyName",
          "label": "Company Name",
          "placeholder": "Enter company name",
          "required": true,
          "validation": {
            "minLength": 2,
            "maxLength": 255,
            "pattern": null
          },
          "style": {
            "className": "w-full",
            "containerClassName": "mb-4"
          }
        }
      ]
    }
  ]
}
```

#### 2. `form_submissions` Table
**Purpose**: Store form submissions with all field values

**Schema**:
```sql
CREATE TABLE form_submissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    form_id VARCHAR(100) NOT NULL REFERENCES forms(form_id),
    submission_id VARCHAR(100) UNIQUE NOT NULL,
    submitted_data JSONB NOT NULL,  -- All form field values
    status VARCHAR(50) NOT NULL,  -- draft, submitted, reviewing, approved, rejected
    submitted_by VARCHAR(255),
    submitted_at TIMESTAMP DEFAULT NOW(),
    reviewed_by VARCHAR(255),
    reviewed_at TIMESTAMP,
    review_notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**JSONB Structure** (`submitted_data`):
```json
{
  "step-1": {
    "companyName": "ABC Company Sdn Bhd",
    "businessType": "Sdn Bhd",
    "registrationNumber": "123456-X"
  },
  "step-2": {
    "contactEmail": "contact@abccompany.com",
    "contactPhone": "+60123456789"
  },
  "step-3": {
    "documents": [
      {
        "fieldName": "businessCertificate",
        "fileName": "certificate.pdf",
        "fileId": "uuid-here"
      }
    ]
  }
}
```

#### 3. `file_uploads` Table
**Purpose**: Store file upload metadata

**Schema**:
```sql
CREATE TABLE file_uploads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    submission_id UUID NOT NULL REFERENCES form_submissions(id) ON DELETE CASCADE,
    field_name VARCHAR(100) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT NOT NULL,
    mime_type VARCHAR(100),
    storage_location VARCHAR(50) DEFAULT 'local',  -- local, s3, azure, gcp
    storage_url VARCHAR(500),
    uploaded_at TIMESTAMP DEFAULT NOW()
);
```

#### 4. `form_fields` Table
**Purpose**: Admin management of field definitions

**Schema**:
```sql
CREATE TABLE form_fields (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    form_id VARCHAR(100) NOT NULL REFERENCES forms(form_id),
    field_id VARCHAR(100) NOT NULL,
    field_type VARCHAR(50) NOT NULL,
    field_order INTEGER NOT NULL,
    step_id VARCHAR(100),
    schema_data JSONB NOT NULL,  -- Field schema
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(form_id, field_id)
);
```

#### 5. `audit_logs` Table
**Purpose**: System audit trail

**Schema**:
```sql
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    action_type VARCHAR(50) NOT NULL,  -- create, update, delete, review, approve, reject
    entity_type VARCHAR(50) NOT NULL,  -- form, submission, user
    entity_id VARCHAR(100) NOT NULL,
    user_id VARCHAR(255),
    user_role VARCHAR(50),
    changes JSONB,  -- Before/after values
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Indexes for Performance

```sql
-- Form lookups
CREATE INDEX idx_forms_form_id ON forms(form_id);
CREATE INDEX idx_forms_is_active ON forms(is_active);

-- Submission queries
CREATE INDEX idx_form_submissions_form_id ON form_submissions(form_id);
CREATE INDEX idx_form_submissions_status ON form_submissions(status);
CREATE INDEX idx_form_submissions_submitted_at ON form_submissions(submitted_at DESC);
CREATE INDEX idx_form_submissions_submitted_by ON form_submissions(submitted_by);

-- JSONB indexes for querying schema_data and submitted_data
CREATE INDEX idx_forms_schema_data_gin ON forms USING GIN(schema_data);
CREATE INDEX idx_form_submissions_data_gin ON form_submissions USING GIN(submitted_data);

-- File uploads
CREATE INDEX idx_file_uploads_submission_id ON file_uploads(submission_id);
CREATE INDEX idx_file_uploads_field_name ON file_uploads(field_name);

-- Form fields
CREATE INDEX idx_form_fields_form_id ON form_fields(form_id);
CREATE INDEX idx_form_fields_step_id ON form_fields(step_id);

-- Audit logs
CREATE INDEX idx_audit_logs_entity_type_id ON audit_logs(entity_type, entity_id);
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at DESC);
```

---

## ğŸ”Œ API ARCHITECTURE

### API Design Principles
- **RESTful**: Follow REST conventions
- **Stateless**: No server-side session state
- **JSON**: All requests/responses in JSON
- **Versioned**: API versioning strategy
- **Documented**: OpenAPI/Swagger documentation
- **Secure**: JWT authentication, rate limiting, CORS

### API Endpoints Overview

#### Forms API (`/api/forms`)
- `GET /api/forms` - List all available forms
- `GET /api/forms/{formId}` - Get form details
- `GET /api/forms/{formId}/schema` - Get complete form schema for rendering

#### Submissions API (`/api/forms/{formId}`)
- `POST /api/forms/{formId}/validate` - Validate submission data
- `POST /api/forms/{formId}/submit` - Submit form data
- `POST /api/forms/{formId}/draft` - Save draft submission
- `GET /api/forms/{formId}/submissions/{submissionId}` - Get submission details
- `GET /api/submissions` - List user's submissions (with filters)

#### File Upload API (`/api/files`)
- `POST /api/files/upload` - Upload file
- `GET /api/files/{fileId}` - Download file
- `DELETE /api/files/{fileId}` - Delete file

#### Admin API (`/api/admin`)
- `GET /api/admin/submissions` - List all submissions (with filters, pagination)
- `GET /api/admin/submissions/{submissionId}` - Get submission details
- `PUT /api/admin/submissions/{submissionId}` - Review submission (approve/reject)
- `GET /api/admin/forms` - Manage form schemas
- `POST /api/admin/forms` - Create new form schema
- `PUT /api/admin/forms/{formId}` - Update form schema
- `DELETE /api/admin/forms/{formId}` - Delete form schema
- `GET /api/admin/audit-logs` - View audit logs

#### Authentication API (`/api/auth`)
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/logout` - User logout
- `POST /api/auth/refresh` - Refresh JWT token
- `GET /api/auth/me` - Get current user

---

## ğŸ¨ FRONTEND ARCHITECTURE

### Component Hierarchy

```
DynamicForm (Container)
  â”œâ”€â”€ FormRenderer (Recursive Renderer)
  â”‚     â”œâ”€â”€ FormStep (Multi-step navigation)
  â”‚     â”‚     â”œâ”€â”€ FormSection (Section grouping)
  â”‚     â”‚     â”‚     â”œâ”€â”€ FieldGroup (Field grouping)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ InputField (text, number, email, etc.)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ SelectField (single/multi, with Other)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ ToggleField (checkbox, radio, switch)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ UploadField (file upload)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ DatePickerField (date/time picker)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ ArrayField (dynamic array)
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â”€ TableField (editable table)
  â”‚     â”‚     â”‚     â”‚     â””â”€â”€ [85+ field types...]
  â”‚     â”‚     â”‚     â””â”€â”€ FieldLabel (label with help text)
  â”‚     â”‚     â”‚     â””â”€â”€ FieldValidation (error display)
  â”‚     â”‚     â””â”€â”€ FormActions (submit, reset, cancel)
```

### State Management

**Form State**: React Hook Form or Formik
- Manages form field values
- Handles validation state
- Tracks dirty/touched/errors
- Supports nested fields and arrays

**API State**: React Query or SWR
- Caches form schemas
- Manages API request states (loading, error, success)
- Handles refetching and invalidation
- Optimistic updates

**Global State**: Context API or Zustand
- User authentication state
- Selected form state
- Theme/preferences

---

## ğŸ”’ SECURITY ARCHITECTURE

### Authentication & Authorization
- **JWT Tokens**: Stateless authentication
- **Refresh Tokens**: Long-lived refresh tokens
- **Role-Based Access Control (RBAC)**: Admin, User, Guest roles
- **API Key Authentication**: For programmatic access (future)

### Data Security
- **Encryption at Rest**: Database encryption (PostgreSQL)
- **Encryption in Transit**: HTTPS/TLS for all communications
- **Input Validation**: Server-side validation for all inputs
- **SQL Injection Prevention**: Parameterized queries (SQLAlchemy)
- **XSS Prevention**: React's built-in XSS protection, input sanitization
- **CSRF Protection**: CSRF tokens for state-changing operations

### API Security
- **Rate Limiting**: Per IP, per user, per endpoint
- **CORS Configuration**: Restricted to allowed origins
- **Security Headers**: CSP, X-Frame-Options, X-Content-Type-Options
- **Request Size Limits**: Max payload size limits
- **File Upload Security**: Type validation, size limits, virus scanning (optional)

---

## âš¡ PERFORMANCE ARCHITECTURE

### Caching Strategy
- **API Response Caching**: Cache form schemas (Redis or in-memory)
- **CDN**: Static assets (frontend build)
- **Database Query Caching**: Frequently accessed queries
- **Browser Caching**: Static resources with cache headers

### Database Optimization
- **Indexing**: Strategic indexes on JSONB fields (GIN indexes)
- **Connection Pooling**: SQLAlchemy connection pool
- **Query Optimization**: Efficient queries, avoid N+1 problems
- **Pagination**: Limit result sets, cursor-based pagination

### Frontend Performance
- **Code Splitting**: Dynamic imports, route-based splitting
- **Lazy Loading**: Components loaded on demand
- **Memoization**: React.memo, useMemo, useCallback
- **Virtual Scrolling**: For large lists
- **Image Optimization**: Lazy loading, responsive images

---

## ğŸ“¦ DEPLOYMENT ARCHITECTURE

### Containerization
- **Docker**: Containerize backend (FastAPI)
- **Docker Compose**: Local development environment
- **Multi-stage Builds**: Optimized production images

### Cloud Deployment
- **Container Registry**: Docker Hub, AWS ECR, Azure ACR, GCP GCR
- **Container Orchestration**: Kubernetes, AWS ECS, Azure Container Apps
- **Load Balancing**: Cloud load balancer
- **Auto-scaling**: Horizontal pod autoscaling
- **Database**: Managed PostgreSQL (RDS, Cloud SQL, Azure Database)

### CI/CD Pipeline
- **Version Control**: Git (GitHub, GitLab, Bitbucket)
- **Build**: Automated builds on push
- **Testing**: Automated tests (unit, integration, E2E)
- **Deployment**: Automated deployment to staging/production
- **Monitoring**: Application monitoring and logging

---

## ğŸ”„ INTEGRATION PATTERNS

### Payment Gateway Integration
- **Stripe**: Credit card payments
- **PayPal**: PayPal checkout
- **Webhook Handling**: Payment status updates

### Email Service Integration
- **SendGrid / Mailgun / AWS SES**: Transactional emails
- **Email Templates**: Confirmation, notification emails

### File Storage Integration
- **Local Storage**: Development (uploads/ directory)
- **AWS S3**: Production file storage
- **Azure Blob Storage**: Alternative cloud storage
- **GCP Cloud Storage**: Alternative cloud storage

### Secrets Management Integration
- **AWS Secrets Manager**: Production secrets
- **Azure Key Vault**: Alternative secrets storage
- **GCP Secret Manager**: Alternative secrets storage
- **Local Config**: Development (config.local.toml)

---

## ğŸ“‹ TECHNOLOGY STACK SUMMARY

### Frontend
- **Framework**: React 18+ (TypeScript)
- **Styling**: Tailwind CSS
- **State Management**: React Hook Form / Formik, React Query / SWR
- **Build Tool**: Vite or Next.js
- **Package Manager**: npm or yarn

### Backend
- **Framework**: FastAPI (Python 3.11+)
- **ORM**: SQLAlchemy 2.0+
- **Migrations**: Alembic
- **Validation**: Pydantic
- **Authentication**: python-jose (JWT)
- **Packaging**: pyproject.toml

### Database
- **Primary**: PostgreSQL 14+
- **Storage**: JSONB for flexible schemas
- **Migrations**: Alembic

### Infrastructure
- **Containerization**: Docker, Docker Compose
- **Deployment**: Kubernetes / Cloud Container Services
- **Monitoring**: Application performance monitoring
- **Logging**: Structured logging

---

**Document Status**: âœ… Complete  
**Next Phase**: API Specifications and Database Schema Details  
**Last Updated**: 2025-11-17 15:34:58

